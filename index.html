<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Save the Date: Kashish & Prerna</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Great+Vibes&family=Lato:wght@400;700&display=swap');

        * {
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #fcfbf7;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(212, 175, 55, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(214, 51, 108, 0.03) 0%, transparent 50%),
                radial-gradient(#d4af37 0.5px, transparent 0.5px), 
                radial-gradient(#d4af37 0.5px, #fcfbf7 0.5px);
            background-size: 100% 100%, 100% 100%, 20px 20px, 20px 20px;
            background-position: 0 0, 0 0, 0 0, 10px 10px;
            overflow: hidden;
            font-family: 'Cinzel', serif;
        }

        /* Floating background particles */
        .bg-particle {
            position: absolute;
            color: rgba(212, 175, 55, 0.15);
            font-size: 24px;
            animation: float 10s infinite linear;
            z-index: 0;
            filter: drop-shadow(0 0 3px rgba(212, 175, 55, 0.3));
        }
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg) scale(0.8); opacity: 0; }
            10% { opacity: 0.6; }
            50% { opacity: 0.8; transform: translateY(50vh) rotate(180deg) scale(1.2); }
            90% { opacity: 0.6; }
            100% { transform: translateY(-10vh) rotate(360deg) scale(0.8); opacity: 0; }
        }

        /* Main Card */
        .floral-frame {
            position: relative;
            z-index: 10;
            width: 92%;
            max-width: 400px;
            height: 92vh;
            max-height: 750px;
            border: double 5px #d4af37;
            border-radius: 12px;
            background: #fff;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            justify-content: space-between; 
            animation: cardEntrance 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes cardEntrance {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(30px) rotate(-2deg);
            }
            60% {
                transform: scale(1.02) translateY(-5px) rotate(1deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0) rotate(0deg);
            }
        }
        
        /* CHANGE: Reduced corner animation to diagonal pair only */
        .corner {
            position: absolute;
            font-size: 32px;
            color: #d4af37;
            line-height: 1;
        }
        /* CHANGE: Only top-left and bottom-right animate */
        .corner.animated {
            animation: cornerPulse 4s ease-in-out infinite;
        }
        @keyframes cornerPulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.15); opacity: 1; }
        }
        .tl { top: 10px; left: 10px; }
        .tr { top: 10px; right: 10px; transform: scaleX(-1); }
        .bl { bottom: 10px; left: 10px; transform: scaleY(-1); }
        .br { bottom: 10px; right: 10px; transform: scale(-1); }

        .header-section {
            text-align: center;
            margin-top: 30px;
        }

        .title-text {
            color: #888;
            font-size: 15px;
            letter-spacing: 5px;
            text-transform: uppercase;
            font-weight: 700;
            position: relative;
            padding-bottom: 10px;
        }
        .title-text::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #d4af37, transparent);
        }

        /* --- HEART CONTAINER --- */
        .heart-wrapper {
            position: relative;
            /* CHANGE: Increased from 320x290 to 340x310 for better venue visibility */
            width: 340px; 
            height: 310px;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .heart-shape {
            position: relative;
            width: 100%;
            height: 100%;
            /* CHANGE: Updated clip-path to match new dimensions (scaled proportionally) */
            clip-path: path("M170 21 C85 -53 -74 96 170 309 C414 96 255 -53 170 21 Z");
            -webkit-clip-path: path("M170 21 C85 -53 -74 96 170 309 C414 96 255 -53 170 21 Z");
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        .heart-shape::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            /* CHANGE: Updated clip-path to match new dimensions */
            clip-path: path("M170 21 C85 -53 -74 96 170 309 C414 96 255 -53 170 21 Z");
            -webkit-clip-path: path("M170 21 C85 -53 -74 96 170 309 C414 96 255 -53 170 21 Z");
            background: radial-gradient(circle, rgba(214, 51, 108, 0.5), transparent);
            opacity: 0;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes heartGlow {
            0%, 100% { opacity: 0; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.08); }
        }

        .heart-shape.revealed::after {
            animation: heartGlow 1.5s ease-in-out infinite;
        }

        /* CHANGE: Added swipe hint overlay */
        .swipe-hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 6;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.5s ease;
        }
        .swipe-hint.hidden {
            opacity: 0;
        }
        .swipe-hint svg {
            width: 60px;
            height: 60px;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));
            animation: swipeAnimation 2s ease-in-out infinite;
        }
        @keyframes swipeAnimation {
            0%, 100% { transform: translateX(-10px); opacity: 0.6; }
            50% { transform: translateX(10px); opacity: 1; }
        }

        /* The Reveal Layer (Inside Heart) */
        .hidden-content {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            /* Original: background: radial-gradient(circle at 50% 30%, #ffffff, #fff5f8); */
            background: radial-gradient(circle at 50% 30%, #fff9f9, #ffe8ec);
            /* background: radial-gradient(circle at 50% 30%, #fefcf7, #f5ead8); */
            /* CHANGE: Soft lavender gradient */
            /* background: radial-gradient(circle at 50% 30%, #fdfbff, #f3ebff); */
            /* CHANGE: Warm coral gradient */
            /* background: radial-gradient(circle at 50% 30%, #fffaf8, #fff0eb); */
            /* CHANGE: Soft mint gradient */
            /* background: radial-gradient(circle at 50% 30%, #f9fffc, #edf7f2); */
            box-shadow: inset 0 0 20px rgba(0,0,0,0.15); 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; 
            padding-top: 55px; 
            box-sizing: border-box;
            z-index: 1;
        }

        .names-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 8px;
        }

        .name {
            font-family: 'Great Vibes', cursive;
            font-size: 42px;
            /* Original: color: #d6336c; */
            color: #c94277;
            /* color: #8b2f39; */
            /* CHANGE: Deep purple-pink */
            /* color: #9b4f96; */
            /* CHANGE: Vibrant coral */
            /* color: #ff6b6b; */
            /* CHANGE: Deep sage green */
            /* color: #5a7d5f; */
            line-height: 0.9;
            text-shadow: 2px 2px 0 #fff, -1px -1px 0 rgba(214, 51, 108, 0.1);
        }
        
        .ampersand {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            color: #c5a02e;
            margin: 4px 0;
        }

        .date {
            font-family: 'Cinzel', serif;
            font-size: 17px;
            /* Original: color: #222; */
            color: #3d2e2e;
            /* color: #5c4a3a; */
            /* CHANGE: Plum */
            /* color: #4a2c4a; */
            /* CHANGE: Terracotta */
            /* color: #8b4513; */
            /* CHANGE: Forest green */
            /* color: #2d4a2b; */
            font-weight: 800;
            margin-top: 10px;
            letter-spacing: 1px;
        }

        .venue {
            font-family: 'Lato', sans-serif;
            /* CHANGE: Reduced from 12px to 10px for better fit inside heart */
            font-size: 10px;
            /* Original: color: #666; */
            color: #8b6f7d;
            /* color: #9d7e4f; */
            /* CHANGE: Dusty lavender */
            /* color: #8b7a9d; */
            /* CHANGE: Burnt sienna */
            /* color: #a0522d; */
            /* CHANGE: Olive green */
            /* color: #6b8e6f; */
            margin-top: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.8px;
            text-align: center;
            line-height: 1.5;
            width: 75%;
        }

        /* Canvas (Scratch Surface) */
        canvas#scratchCanvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 5;
            cursor: pointer;
            touch-action: none;
            transition: opacity 0.8s ease-out;
            background: 
                linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.4) 50%, transparent 100%),
                linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            background-size: 200% 100%, 300% 300%;
            animation: shimmer 2.5s infinite, shimmerDiagonal 4s infinite;
        }
        @keyframes shimmer {
            0% { background-position: -200% center, 0% 0%; }
            100% { background-position: 200% center, 0% 0%; }
        }
        @keyframes shimmerDiagonal {
            0% { background-position: 0% 0%, -100% -100%; }
            100% { background-position: 0% 0%, 100% 100%; }
        }

        /* Confetti Canvas (Overlay) */
        #confettiCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        /* Footer Section */
        .footer-section {
            text-align: center;
            margin-bottom: 30px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 14px;
        }

        /* CHANGE: Moved countdown above instruction for better hierarchy */
        .countdown {
            margin-top: 0;
            display: flex;
            gap: 15px;
            justify-content: center;
            /* CHANGE: Start hidden, will be shown after reveal */
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            /* CHANGE: Initially hidden from layout */
            display: none;
        }

        /* CHANGE: New class to show countdown after reveal */
        .countdown.show {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        .countdown-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 18px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.08), rgba(212, 175, 55, 0.15));
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .countdown-value {
            font-family: 'Cinzel', serif;
            font-size: 28px;
            font-weight: 700;
            color: #d4af37;
            line-height: 1;
            text-shadow: 0 2px 4px rgba(212, 175, 55, 0.2);
        }

        .countdown-label {
            font-family: 'Lato', sans-serif;
            font-size: 10px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-top: 6px;
            font-weight: 600;
        }

        /* CHANGE: Enhanced progress container with percentage display */
        .progress-container {
            width: 85%;
            height: 6px;
            background: rgba(212, 175, 55, 0.25);
            border-radius: 3px;
            margin: 0 auto;
            overflow: visible;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            position: relative;
        }

        .progress-container.active {
            opacity: 1;
        }

        /* CHANGE: Added percentage text */
        .progress-percentage {
            position: absolute;
            top: -22px;
            right: 0;
            font-family: 'Lato', sans-serif;
            font-size: 11px;
            font-weight: 700;
            color: #d4af37;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .progress-container.active .progress-percentage {
            opacity: 1;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #d4af37, #FFD700, #d4af37);
            background-size: 200% 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
            animation: progressShine 2s infinite;
            box-shadow: 0 0 8px rgba(212, 175, 55, 0.6);
        }
        @keyframes progressShine {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .instruction {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 2.5px;
            animation: pulse 1.2s infinite;
            font-weight: 600;
        }

        .reveal-message {
            font-family: 'Great Vibes', cursive;
            font-size: 28px;
            color: #d4af37;
            opacity: 0;
            transform: translateY(10px);
            transition: all 1s ease;
            display: none;
        }
        
        .reveal-message.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        @keyframes pulse { 
            0% {opacity: 0.4; transform: scale(1);}
            50% {opacity: 1; transform: scale(1.05);} 
            100% {opacity: 0.4; transform: scale(1);} 
        }

        .share-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            justify-content: center;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.6s ease;
        }

        .share-buttons.show {
            opacity: 1;
            transform: translateY(0);
        }

        .share-btn {
            background: linear-gradient(135deg, #d4af37, #c5a02e);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: 'Lato', sans-serif;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .share-btn:active {
            transform: scale(0.95);
        }

        .share-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.5);
        }

        /* CHANGE: SVG icon styling */
        .share-btn svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        /* CHANGE: Custom loading spinner with heart */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fcfbf7;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* CHANGE: Heart-shaped loader */
        .loading-spinner {
            width: 60px;
            height: 60px;
            position: relative;
            animation: heartBeat 1.2s ease-in-out infinite;
        }

        .loading-spinner::before,
        .loading-spinner::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 48px;
            background: #d4af37;
            border-radius: 30px 30px 0 0;
        }

        .loading-spinner::before {
            left: 30px;
            transform: rotate(-45deg);
            transform-origin: 0 100%;
        }

        .loading-spinner::after {
            left: 0;
            transform: rotate(45deg);
            transform-origin: 100% 100%;
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1); }
            75% { transform: scale(1.15); }
        }

        /* CHANGE: Accessibility - Screen reader only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

    </style>
</head>
<body>

    <!-- CHANGE: Enhanced loading overlay with heart spinner -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div id="bg-particles"></div>

    <canvas id="confettiCanvas"></canvas>

    <div class="floral-frame">
        <!-- CHANGE: Only diagonal corners animate -->
        <div class="corner tl animated">✾</div>
        <div class="corner tr">✾</div>
        <div class="corner bl">✾</div>
        <div class="corner br animated">✾</div>

        <div class="header-section">
            <div class="title-text">Save the Date</div>
        </div>

        <div class="heart-wrapper">
            <div class="heart-shape">
                <div class="hidden-content">
                    <div class="names-group">
                        <div class="name">Kashish</div>
                        <div class="ampersand">&</div>
                        <div class="name">Prerna</div>
                    </div>
                    
                    <div class="date">21st Feb, 2026</div>
                    
                    <div class="venue">
                        Ramada by Wyndham,<br>Neemrana
                    </div>
                </div>

                <!-- CHANGE: Added swipe hint SVG -->
                <div class="swipe-hint" id="swipeHint">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path fill="#fff" stroke="#d4af37" stroke-width="1.5" d="M13 5.5C13 3.57 11.43 2 9.5 2C7.466 2 6.25 3.525 6.25 5.5V12.5L4.5 10.75C3.672 9.922 2.328 9.922 1.5 10.75C0.672 11.578 0.672 12.922 1.5 13.75L7.5 19.75C8.328 20.578 9.672 20.578 10.5 19.75L16.5 13.75C17.328 12.922 17.328 11.578 16.5 10.75C15.672 9.922 14.328 9.922 13.5 10.75L13 11.25V5.5Z"/>
                        <path fill="none" stroke="#d4af37" stroke-width="2" stroke-linecap="round" d="M18 8L22 12M22 12L18 16M22 12H14" opacity="0.6">
                            <animate attributeName="opacity" values="0.3;1;0.3" dur="1.5s" repeatCount="indefinite"/>
                        </path>
                    </svg>
                </div>

                <!-- CHANGE: Updated canvas dimensions to match new heart size -->
                <canvas id="scratchCanvas" width="340" height="310"></canvas>
            </div>
        </div>

        <div class="footer-section">
            <!-- CHANGE: Countdown now hidden initially, will show after reveal -->
            <div class="countdown" id="countdown">
                <div class="countdown-item">
                    <span class="countdown-value" id="days">000</span>
                    <span class="countdown-label">Days</span>
                </div>
            </div>

            <!-- CHANGE: Added percentage display -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
                <span class="progress-percentage" id="progressPercentage">0%</span>
            </div>
            
            <div class="instruction" id="instructionText">
                Scratch to Reveal
            </div>
            
            <div class="reveal-message" id="finalMessage">
                More to Come...
                <div class="share-buttons" id="shareButtons">
                    <!-- CHANGE: Replaced emoji with SVG icons -->
                    <button class="share-btn" onclick="shareInvite('whatsapp')" aria-label="Share on WhatsApp">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                        </svg>
                        WhatsApp
                    </button>
                    <button class="share-btn" onclick="shareInvite('copy')" aria-label="Copy link">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                        Copy Link
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- CHANGE: Added ARIA live region for accessibility -->
    <div class="sr-only" role="status" aria-live="polite" aria-atomic="true" id="ariaStatus"></div>

    <script>
        // CHANGE: Hide loading overlay after page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
            }, 500);
        });

        // --- 1. Background Decoration Setup ---
        const particleContainer = document.getElementById('bg-particles');
        for(let i=0; i<20; i++){
            let p = document.createElement('div');
            p.innerHTML = "❤";
            p.className = 'bg-particle';
            p.style.left = Math.random() * 100 + "vw";
            p.style.animationDuration = (Math.random() * 5 + 5) + "s";
            p.style.animationDelay = "-" + (Math.random() * 10) + "s";
            particleContainer.appendChild(p);
        }

        // --- Countdown Timer ---
        function updateCountdown() {
            const weddingDate = new Date('2026-02-20T00:00:00');
            const now = new Date();
            const diff = weddingDate - now;
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            document.getElementById('days').textContent = String(days).padStart(3, '0');
        }

        updateCountdown();
        setInterval(updateCountdown, 86400000);

        // --- 2. Scratch Card Setup ---
        const canvas = document.getElementById('scratchCanvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        let isRevealed = false;
        let hasStartedScratching = false;

        function initCard() {
            const grd = ctx.createLinearGradient(0, 0, width, height);
            grd.addColorStop(0, "#DAA520");
            grd.addColorStop(0.5, "#FFD700");
            grd.addColorStop(1, "#B8860B");
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, width, height);

            for (let i = 0; i < 2500; i++) {
                const rand = Math.random();
                if(rand > 0.93) ctx.fillStyle = "#FFFFFF";
                else if(rand > 0.5) ctx.fillStyle = "#FFC125";
                else ctx.fillStyle = "#8B6914";
                
                const x = Math.random() * width;
                const y = Math.random() * height;
                const size = Math.random() * 3;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }

            ctx.shadowColor = "rgba(0,0,0,0.6)";
            ctx.shadowBlur = 6;
            ctx.fillStyle = "#FFF";
            ctx.font = "bold 22px Cinzel";
            ctx.textAlign = "center";
            ctx.fillText("Scratch Here", width/2, height/2);
            
            ctx.font = "28px Arial";
            ctx.fillText("❤️", width/2, height/2 + 35);
        }
        initCard();

        // --- 3. Scratch Logic ---
        let isDrawing = false;
        function scratch(x, y) {
            if (isRevealed) return;

            // CHANGE: Hide swipe hint on first scratch
            if (!hasStartedScratching) {
                hasStartedScratching = true;
                document.getElementById('swipeHint').classList.add('hidden');
                // CHANGE: Announce to screen readers
                document.getElementById('ariaStatus').textContent = 'Scratching started';
            }

            if ('vibrate' in navigator) {
                navigator.vibrate(10);
            }

            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(x, y, 30, 0, Math.PI * 2);
            ctx.fill();
            checkReveal();
        }

        // --- 4. Auto Reveal & Celebration ---
        let throttleTimer = null;
        function checkReveal() {
            if (throttleTimer) return;
            throttleTimer = setTimeout(() => {
                try {
                    const imageData = ctx.getImageData(0, 0, width, height);
                    const pixels = imageData.data;
                    let transparent = 0;
                    for (let i = 0; i < pixels.length; i += 200) {
                        if (pixels[i + 3] < 128) transparent++;
                    }
                    const progress = (transparent / (pixels.length / 200));
            
                    // CHANGE: Update progress bar with percentage
                    const progressBar = document.getElementById('progressBar');
                    const progressContainer = document.getElementById('progressContainer');
                    const progressPercentage = document.getElementById('progressPercentage');
                    
                    if (progress > 0.05) {
                        progressContainer.classList.add('active');
                        const percentage = Math.min(Math.round(progress * 100), 100);
                        progressBar.style.width = percentage + '%';
                        progressPercentage.textContent = percentage + '%';
                        
                        // CHANGE: Announce progress to screen readers at 25%, 50%, 75%
                        if (percentage === 25 || percentage === 50 || percentage === 75) {
                            document.getElementById('ariaStatus').textContent = `${percentage}% revealed`;
                        }
                    }
                    
                    if (progress > 0.35) {
                        revealAll();
                    }
                } catch (e) {}
                throttleTimer = null;
            }, 150);
        }

        function revealAll() {
            if (isRevealed) return;
            isRevealed = true;

            document.querySelector('.heart-shape').classList.add('revealed');

            const celebrationAudio = document.getElementById('celebrationSound');
            if (celebrationAudio) {
                celebrationAudio.volume = 0.3;
                celebrationAudio.play().catch(() => {});
            }

            canvas.style.opacity = '0';
            document.getElementById('instructionText').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            
            // CHANGE: Show countdown after reveal
            const countdown = document.getElementById('countdown');
            setTimeout(() => {
                countdown.classList.add('show');
            }, 800);
            
            // CHANGE: Announce reveal to screen readers
            document.getElementById('ariaStatus').textContent = 'Invitation revealed! Save the date for Kashish and Prerna, February 20-22, 2026';
            
            fireConfetti();

            setTimeout(() => {
                document.getElementById('finalMessage').classList.add('show');
                // CHANGE: Delayed share button reveal (1.5s after message)
                setTimeout(() => {
                    document.getElementById('shareButtons').classList.add('show');
                }, 1500);
                setTimeout(() => canvas.style.display = 'none', 800);
            }, 300);
        }

        // Input Handlers
        const getPos = (e) => {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        };

        ['mousedown', 'touchstart'].forEach(evt => 
            canvas.addEventListener(evt, (e) => { 
                isDrawing = true; 
            }, {passive:false})
        );
        ['mouseup', 'touchend'].forEach(evt => 
            canvas.addEventListener(evt, () => isDrawing = false)
        );
        ['mousemove', 'touchmove'].forEach(evt => 
            canvas.addEventListener(evt, (e) => {
                if (isDrawing) {
                    e.preventDefault();
                    const pos = getPos(e);
                    scratch(pos.x, pos.y);
                }
            }, {passive:false})
        );


        // --- 5. Enhanced Confetti System ---
        const cCanvas = document.getElementById('confettiCanvas');
        const cCtx = cCanvas.getContext('2d');
        let particles = [];

        function resizeConfetti() {
            cCanvas.width = window.innerWidth;
            cCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeConfetti);
        resizeConfetti();

        function fireConfetti() {
            const colors = ['#d4af37', '#FFD700', '#c21e56', '#ffb7b2', '#FFF', '#ff69b4'];
            for(let i=0; i<150; i++) {
                particles.push({
                    x: window.innerWidth / 2,
                    y: window.innerHeight / 2,
                    vx: (Math.random() - 0.5) * 20,
                    vy: (Math.random() - 0.5) * 20 - 8,
                    life: 120,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 6 + 3,
                    rotation: Math.random() * 360,
                    rotationSpeed: (Math.random() - 0.5) * 10
                });
            }
            animateConfetti();
        }

        function animateConfetti() {
            if(particles.length === 0) return;
            cCtx.clearRect(0, 0, cCanvas.width, cCanvas.height);
            
            for(let i=0; i<particles.length; i++) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.3;
                p.rotation += p.rotationSpeed;
                p.life--;
                
                cCtx.save();
                cCtx.translate(p.x, p.y);
                cCtx.rotate(p.rotation * Math.PI / 180);
                cCtx.globalAlpha = p.life / 120;
                cCtx.fillStyle = p.color;
                cCtx.fillRect(-p.size/2, -p.size/2, p.size, p.size * 1.5);
                cCtx.restore();
            }
            particles = particles.filter(p => p.life > 0);
            requestAnimationFrame(animateConfetti);
        }

        function shareInvite(platform) {
            const url = window.location.href;
            const text = "Save the Date: Kashish & Prerna's Wedding | 20-22 Feb 2026 | Ramada by Wyndham, Neemrana";
            
            if (platform === 'whatsapp') {
                window.open(`https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`, '_blank');
            } else if (platform === 'copy') {
                navigator.clipboard.writeText(url).then(() => {
                    const btn = event.target.closest('.share-btn');
                    const originalHTML = btn.innerHTML;
                    // CHANGE: Updated SVG for checkmark
                    btn.innerHTML = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Copied!';
                    btn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                        btn.style.background = 'linear-gradient(135deg, #d4af37, #c5a02e)';
                    }, 2000);
                }).catch(() => {
                    prompt('Copy this link:', url);
                });
            }
        }

    </script>

    <audio id="scratchSound" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3" type="audio/mpeg">
    </audio>
    <audio id="celebrationSound" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3" type="audio/mpeg">
    </audio>

</body>
</html>